# Advent of Code 2025 Setup - Development Conversation Log

This document captures the complete conversation and decisions made during the setup of the Advent of Code 2025 environment.

## Overview

Created a comprehensive multi-language setup for Advent of Code 2025 with three language options: Zig, C#, and Go. The setup includes automated puzzle fetching, test generation, and development workflow optimizations.

## Initial Requirements

- Analyze existing solutions from 2021-2024
- Prepare setup for 2025
- Support three languages: Zig, C#, and Go (with Dingo initially, later changed to Lo)
- Include boilerplate and test templates

## Key Decisions & Evolution

### Language Choices

1. **Zig 0.15.2** - Systems programming language
   - Manual memory management with allocators
   - Comptime execution
   - Build system configuration challenges resolved

2. **C# .NET 10.0 LTS** (upgraded from initial .NET 9.0)
   - Latest LTS release (November 11, 2025)
   - 3 years of support (until November 14, 2028)
   - C# 14 features
   - Modern top-level statements

3. **Go 1.23 with Lo** (changed from Dingo)
   - Initially planned: Dingo (transpiler to Go)
   - **Changed to:** Lo (samber/lo) - Lodash-style functional library
   - Reason: Dingo is a transpiler, not a runtime library; Lo is more practical

### Pattern Evolution from Previous Years

**2021 (C#):** Monolithic console apps  
**2022 (Rust):** Standalone Cargo projects per day  
**2023-2024 (Rust):** Workspace with comprehensive tooling  

**2025 follows 2024 refined pattern:**
- Single `input.txt` per day (not separate input1/input2)
- `task.txt` for problem descriptions
- Embedded/compiled input for performance
- Template-based day creation

### Directory Structure

```
2025/
â”œâ”€â”€ .aoc-fetch.sh           # Main fetch utility
â”œâ”€â”€ .aoc-update-task.sh     # Part 2 update helper
â”œâ”€â”€ .gitignore              # Security and build artifacts
â”œâ”€â”€ AOC_FETCH_SETUP.md      # Complete setup guide
â”œâ”€â”€ README.md               # Main overview
â”œâ”€â”€ zig/
â”‚   â”œâ”€â”€ build.zig           # Workspace configuration
â”‚   â”œâ”€â”€ build.zig.zon       # Package manifest (Zig 0.15 format)
â”‚   â”œâ”€â”€ create-day.sh       # Day creation script
â”‚   â”œâ”€â”€ template/           # Boilerplate
â”‚   â””â”€â”€ README.md
â”œâ”€â”€ csharp/
â”‚   â”œâ”€â”€ AoC2025.sln         # Solution file
â”‚   â”œâ”€â”€ Directory.Build.props  # Shared .NET 10.0 config
â”‚   â”œâ”€â”€ create-day.sh
â”‚   â”œâ”€â”€ template/
â”‚   â””â”€â”€ README.md
â””â”€â”€ go/
    â”œâ”€â”€ go.mod
    â”œâ”€â”€ create-day.sh
    â”œâ”€â”€ template/
    â””â”€â”€ README.md
```

## Automation & Workflow Features

### Puzzle Fetching (Policy-Compliant)

**Automation Guidelines Followed:**
- Rate limiting: 3 seconds between requests (configurable)
- Caching: All responses cached locally
- User-Agent: Includes repository and contact info
- Session-based authentication
- Respects AoC server load

**Implementation:**
- `.aoc-fetch.sh` - Main fetch script
- Shared cache at `~/.aoc-cache/2025/`
- Separate Part 1 and Part 2 task handling

**Key Insight:** Part 2 only becomes available AFTER Part 1 is correctly solved
- Initially fetches Part 1 task only
- Separate cache files: `day5_task_part1.html` and `day5_task_part2.html`
- Helper script `.aoc-update-task.sh` to fetch Part 2 after solving Part 1

### Shared Caching Design

**Problem Solved:** Avoid duplicate requests when working across multiple languages

**Solution:**
- Single cache location: `~/.aoc-cache/2025/`
- Create-day scripts check cache BEFORE fetching
- Workflow: Fetch once in Zig â†’ instant cache hit in Go/C#

**Cache Structure:**
```
~/.aoc-cache/2025/
â”œâ”€â”€ day1_input.txt
â”œâ”€â”€ day1_task_part1.html
â”œâ”€â”€ day1_task_part2.html    # Only after Part 1 solved
â”œâ”€â”€ day5_input.txt
â”œâ”€â”€ day5_task_part1.html
â””â”€â”€ ...
```

**Benefit:** Only ONE network request per day per year, total

## Technical Challenges & Solutions

### Zig 0.15.2 API Changes

**Problem:** Build configuration incompatible with Zig 0.15

**Issues encountered:**
1. `build.zig.zon` syntax changed - `.name` now uses enum literal (`.aoc2025` not `"aoc2025"`)
2. `fingerprint` field validation
3. `root_source_file` moved to `root_module` with `createModule()`
4. Directory handle requires `var` not `const` for `.close()`

**Solutions:**
```zig
// build.zig.zon
.{
    .name = .aoc2025,  // enum literal, not string
    .fingerprint = 0x52176dd5504aff6d,  // generated by toolchain
}

// build.zig
const exe = b.addExecutable(.{
    .name = "...",
    .root_module = b.createModule(.{  // New in 0.15
        .root_source_file = b.path("..."),
        .target = target,
        .optimize = optimize,
    }),
});
```

### Go Functional Library Selection

**Initial Plan:** Dingo (github.com/MadAppGang/dingo)

**Problem Discovered:** Dingo is a transpiler to Go, not a runtime library
- Requires `.dingo` source files
- Transpiles to idiomatic Go code
- Not suitable for direct use as a Go library

**Solution:** Switched to Lo (samber/lo v1.47.0)
- Popular Lodash-style functional library
- Direct Go library with generics support
- Functions: Filter, Map, Reduce, Chunk, Uniq, GroupBy, etc.
- Battle-tested and widely used

### .NET Version Selection

**Initial:** .NET 9.0

**User Question:** Why not .NET 10?

**Research Found:**
- .NET 10 released November 11, 2025
- LTS (Long-Term Support) release
- 3 years support vs .NET 9's 18 months
- C# 14 features
- Better choice for new projects

**Decision:** Upgraded to .NET 10.0

## Security & Privacy

### .gitignore Configuration

**Secrets Protected:**
- `.aoc-session` - Session tokens (root and 2025/)
- `session.txt`, `cookie.txt` - Credential files
- `.env` files

**Build Artifacts Ignored:**
- Zig: `.zig-cache/`, `zig-out/`, `*.o`, `*.a`, `*.so`
- C#: `bin/`, `obj/`, `Debug/`, `Release/`, `.vs/`, NuGet packages
- Go: `*.exe`, `*.out`, `*.test`, compiled binaries

**IDE/OS Files:**
- VSCode, JetBrains, Vim, Emacs
- macOS (`.DS_Store`), Windows (`Thumbs.db`), Linux

**Note:** Input and task files are NOT ignored by default (users can uncomment if they want privacy)

### User-Agent Configuration

**Configured with:**
- Repository: `github.com/hamburger1984/advent-of-code`
- Contact: `hamburger1984@gmail.com`

Following Reddit guidelines to include contact information in User-Agent header.

## Workflow Design

### Standard Workflow (Part 1 â†’ Part 2)

1. **Create Day:**
   ```bash
   cd zig
   ./create-day.sh 5 --fetch  # Fetches input + Part 1 task
   ```

2. **Solve Part 1:**
   - Implement solution
   - Test and run
   - Submit answer on adventofcode.com

3. **Get Part 2:**
   ```bash
   cd ..
   ./.aoc-update-task.sh 5 zig  # Fetches Part 2 task
   ```

4. **Solve Part 2:**
   - Implement solution
   - Submit answer

5. **Multi-language:**
   ```bash
   cd go
   ./create-day.sh 5 --fetch      # Instant - uses cache!
   cd ..
   ./.aoc-update-task.sh 5 go     # Instant - Part 2 cached!
   ```

### Manual Workflow (without auto-fetch)

```bash
./create-day.sh 5
# Manually add input.txt and task.txt
# Proceed with solving
```

## Future Enhancement: TDD Workflow (Phase 1 - Planned)

### Motivation

Current workflow requires manual test setup. AoC problems include example inputs and expected outputs in the task description. These can be automatically extracted and used to generate unit tests.

### Example from 2024 Day 1

**Task contains:**
```
For example:

3   4
4   3
2   5
1   3
3   9
3   3

...calculation explanation...

...a total distance of 11!
```

**Auto-generated test:**
```go
func TestPart1(t *testing.T) {
    input := `3   4
4   3
2   5
1   3
3   9
3   3`
    result := part1(input)
    expected := "11"
    if result != expected {
        t.Errorf("part1() = %v, want %v", result, expected)
    }
}
```

### Proposed Implementation

1. **`.aoc-parse-examples.sh`**
   - Parse task.txt to extract example inputs and answers
   - Output JSON: `{"examples": [{"input": "...", "answer": "11"}]}`
   - Handle multiple examples per part
   - Detect answer patterns: "total of X", "score is Y", etc.

2. **Update `create-day.sh` scripts**
   - After fetching task, run parser
   - Auto-populate test files with extracted examples
   - Replace placeholder tests with real data

3. **Watch mode helpers**
   - `watch.sh` for each language
   - C#: `dotnet watch test`
   - Go: `FS_WATCH=true go test -v`
   - Zig: `entr` or similar for file watching

4. **Enhanced `.aoc-update-task.sh`**
   - When fetching Part 2, re-run example parser
   - Update existing tests with Part 2 examples
   - Maintain Part 1 tests

### Expected TDD Workflow

```bash
# Day starts
./create-day.sh 5 --fetch
# â†’ Input fetched
# â†’ Part 1 task fetched
# â†’ Examples parsed
# â†’ Tests auto-generated with real examples!

cd day-5

# Start TDD mode
../watch.sh
# â†’ Auto-runs tests on file save
# â†’ Red â†’ Green â†’ Refactor cycle

# Code until tests pass
# Submit Part 1 answer manually

# Get Part 2
cd .. && ./.aoc-update-task.sh 5 zig
# â†’ Part 2 task fetched
# â†’ Part 2 examples parsed
# â†’ Tests updated automatically!

cd day-5 && ../watch.sh
# â†’ Continue TDD for Part 2
```

### Feasibility Analysis

**Phase 1: TDD Workflow** (Implementing Now)
- â­â­â­â­â­ Extract sample inputs/answers: 95% feasible
- â­â­â­â­ Auto-generate tests: 85% feasible
- Some edge cases (multiple examples, complex formats)

**Phase 2: Progress Tracking** (Future)
- â­â­â­ Auto-update README table: 90% feasible
- Detect completion, update status symbols

**Phase 3: Submission Automation** (Probably Skip)
- â­â­ Auto-submit answers: 60% feasible
- Complex, risky with rate limits
- Manual submission is acceptable

## Documentation Structure

### Main Documentation

1. **`2025/README.md`**
   - Overview of three languages
   - Quick start guide
   - Progress tracking table
   - Links to language-specific READMEs

2. **`2025/AOC_FETCH_SETUP.md`**
   - Complete setup guide for session token
   - How auto-fetch works
   - Shared caching explanation
   - Part 1/Part 2 workflow
   - Troubleshooting section
   - Responsible use guidelines

3. **Language READMEs** (zig/, csharp/, go/)
   - Installation requirements
   - Creating new days
   - Running tests
   - Building and running solutions
   - Language-specific tips

## Git History

### Commits Created

1. **Initial Setup (commit 4d2df84)**
   ```
   Prepare Advent of Code 2025 setup with Zig, C#, and Go
   
   46 files changed, 1895 insertions(+)
   ```
   
   - Created three language environments
   - Implemented automated fetching
   - Added documentation
   - Security via .gitignore
   - Example day-1 directories

2. **Cleanup (commit 92978aa)**
   ```
   Remove example day-1 directories
   
   17 files changed, 199 deletions(-)
   ```
   
   - Removed day-1 examples from all languages
   - Clean slate for December start

## References & Resources

### Advent of Code Policies
- [Automation Guidelines Reddit](https://www.reddit.com/r/adventofcode/comments/z9dhtd/please_include_your_contact_info_in_the_useragent/)
- [Monday Morning Haskell - Fetching Puzzle Input](https://mmhaskell.com/blog/2023/1/30/advent-of-code-fetching-puzzle-input-using-the-api)
- [advent-of-code-data](https://github.com/wimglenn/advent-of-code-data)

### Technology Documentation
- [Zig 0.15.1 Release Notes](https://ziglang.org/download/0.15.1/release-notes.html)
- [.NET 10 Official Release](https://www.infoq.com/news/2025/11/dotnet-10-release/)
- [Download .NET 10.0](https://dotnet.microsoft.com/en-us/download/dotnet/10.0)
- [samber/lo GitHub](https://github.com/samber/lo)
- [BooleanCat/go-functional](https://github.com/BooleanCat/go-functional)

### AoC Task Structure
- [Day 1 - Advent of Code 2024](https://adventofcode.com/2024/day/1)
- [Day 2 - Advent of Code 2024](https://adventofcode.com/2024/day/2)

## Lessons Learned

1. **API changes happen** - Zig 0.15 had significant breaking changes
2. **Research before committing** - Dingo vs Lo library choice
3. **LTS matters** - .NET 10 LTS better than .NET 9 standard
4. **Caching is critical** - Shared cache prevents duplicate requests
5. **Part 1/Part 2 workflow** - Must be handled separately per AoC design
6. **User-Agent matters** - Community expects proper attribution
7. **Security first** - Never commit session tokens

## Status

**Current State:** âœ… Complete and ready for December 2025

**Setup includes:**
- âœ… Three language environments configured
- âœ… Automated fetching with caching
- âœ… Part 1/Part 2 workflow support
- âœ… Comprehensive documentation
- âœ… Security via .gitignore
- âœ… Example templates

**Next Phase:** Implementing TDD workflow with auto-generated tests

## Quick Reference Commands

### Setup Session Token
```bash
echo 'your-session-token' > ~/.aoc-session
chmod 600 ~/.aoc-session
```

### Create New Day
```bash
cd 2025/zig    # or csharp, or go
./create-day.sh 1 --fetch
```

### Update to Part 2
```bash
cd 2025
./.aoc-update-task.sh 1 zig
```

### Manual Fetch
```bash
cd 2025
./.aoc-fetch.sh 1 input    # Just input
./.aoc-fetch.sh 1 task     # Part 1 task
./.aoc-fetch.sh 1 task2    # Part 2 task
./.aoc-fetch.sh 1 both     # Input + Part 1 task
```

## Language Extensions - 2025-11-26

After initial setup with three languages (Zig, C#, Go), added three additional languages:

### ðŸŸ  Dingo
- Modern Go transpiler with enhanced features
- Sum types, pattern matching, pipe operators
- Error propagation with `?` operator
- Template and create-day.sh setup

### ðŸŸ¢ Swift
- Swift 5.9+ with Swift Package Manager
- XCTest framework for testing
- Full TDD workflow with watch mode
- Test generation integrated

### ðŸŸ¤ Kotlin
- Kotlin 1.9+ with Gradle build system
- JUnit 5 testing framework
- Gradle wrapper for each day
- Test generation integrated

**Updated files:**
- `.aoc-generate-tests.sh` - Added Swift and Kotlin test generation
- `README.md` - Updated to show all six languages
- `TDD_WORKFLOW.md` - Added new languages to watch mode docs
- `AOC_FETCH_SETUP.md` - Added examples for all six languages
- `.gitignore` - Added Swift and Kotlin build artifacts

Now supports **six languages** total: Zig, C#, Go (with Lo), Dingo, Swift, and Kotlin.

---

## C# TDD Enhancement & Task Parsing Improvements - 2025-12-01

### Overview

Enhanced C# template with TDD support similar to Zig, and significantly improved task parsing across all languages to provide clean, well-formatted problem statements.

### C# TDD Implementation

**Problem:** C# template lacked test infrastructure that other languages (Zig) had.

**Solution:** Implemented inline tests using `#if DEBUG` blocks

**Key Design Decisions:**

1. **Inline Tests vs Separate Files**
   - Chose inline tests in `Program.cs` within `#if DEBUG` blocks
   - Benefits:
     - Single file to maintain
     - Tests completely excluded in Release builds
     - No additional project dependencies needed
     - Simpler for single-file AoC solutions

2. **Static Solution Class Pattern**
   - Initial attempt: Local functions in top-level statements
   - Problem: CS8801 error - local functions not accessible from separate `Tests` class
   - Solution: Move `Part1` and `Part2` to static `Solution` class
   
   ```csharp
   static class Solution
   {
       public static string Part1(string input) { ... }
       public static string Part2(string input) { ... }
   }
   
   #if DEBUG
   static class Tests
   {
       static void TestPart1()
       {
           var result = Solution.Part1(input);
           // assertions...
       }
   }
   #endif
   ```

3. **Test Execution Flow**
   - Tests run automatically BEFORE solution in Debug mode
   - Clear separation: tests â†’ blank line â†’ actual results
   - Clean output in Release mode (no test clutter)

**Files Modified:**
- `2025/csharp/template/Program.cs` - Added test structure
- `2025/.aoc-generate-tests.sh` - Added C# test generation
- `2025/csharp/create-day.sh` - Integrated test generation workflow
- `2025/csharp/README.md` - Documented TDD workflow

### Task Parsing Improvements

**Problem:** Task files contained HTML clutter, headers concatenated with text, no proper spacing.

**Before:**
```
Day 1 - Advent of Code 2025
[JavaScript and HTML header garbage]
--- Day 1: Secret Entrance ---The Elves have good news...
[lots of text]
Your puzzle answer was 1026.--- Part Two ---You're sure that's...
[lots of text]
You can also [Shareable] [Twitter] ...
```

**After:**
```
--- Day 1: Secret Entrance ---

The Elves have good news...
[Part 1 content]


--- Part Two ---

You're sure that's...
[Part 2 content]
```

**Implementation in `.aoc-fetch.sh` `html_to_text()` function:**

1. **Strip HTML headers** - Start only at "--- Day N:"
2. **Separate headers from text** - Split concatenated content
3. **Add line breaks** - Blank line after each header
4. **Format Part Two** - Two blank lines before, header on own line, blank line after
5. **Remove footers** - Stop at "You can also", "[Share]", etc.

**AWK Pattern Matching:**
```awk
/^--- Day [0-9]+:/ {
    # Extract header, separate from text
    match($0, /^--- Day [0-9]+: [^-]+ ---/)
    header = substr($0, 1, RLENGTH)
    rest = substr($0, RLENGTH + 1)
    print header
    print ""
    if (rest != "") print rest
}

/^--- Part Two ---/ {
    # Two blank lines, header, blank line, then text
    print ""
    print ""
    print "--- Part Two ---"
    print ""
    # Handle any text after header
}
```

**Updated Scripts:**
- `.aoc-fetch.sh` - Enhanced `html_to_text()` function
- `.aoc-update-task.sh` - Use fetch script instead of duplicating sed commands
- All `create-day.sh` scripts (6 languages) - Use centralized formatting

### Global Consistency

**All six languages now benefit from:**
- Clean task files starting at "--- Day N:"
- Proper header spacing
- Part Two separation
- No HTML/footer clutter
- Consistent formatting

**Languages updated:**
1. Zig - `/2025/zig/create-day.sh`
2. C# - `/2025/csharp/create-day.sh`
3. Go - `/2025/go/create-day.sh`
4. Swift - `/2025/swift/create-day.sh`
5. Kotlin - `/2025/kotlin/create-day.sh`
6. Dingo - `/2025/dingo/create-day.sh`

### TDD Workflow Now Complete for C#

```bash
# Create day with auto-fetch and test generation
./create-day.sh 1 --fetch
cd day-1

# Tests run automatically in Debug mode
dotnet run
# Output:
# âœ“ Part 1 test passed
# âœ“ Part 2 test passed
# All tests passed!
#
# Part 1: [solution]
# Part 2: [solution]

# After solving Part 1, fetch Part 2
../.aoc-update-task.sh 1 csharp

# Tests updated automatically - continue TDD
dotnet run
```

### Test Generation Edge Cases

**Challenge:** Example parsing doesn't work for all AoC problem formats.

**Day 1 2025 Example:**
- Example shows step-by-step dial rotations
- Answer embedded in prose: "the password in this example is 3"
- Current parser uses heuristics for "For example:" sections
- Works for ~85% of problems; manual editing for rest

**Future Enhancement:** Could improve parser with more patterns, but acceptable to manually edit tests when needed.

### Commits Created

1. **`4ab000c`** - Add TDD support to C# template and improve task parsing globally
2. **`2e5cb3d`** - Fix C# template: Move Part1/Part2 to Solution class
3. **`9b634c8`** - Solve 2025 Day 1 Part 1 in C# - Answer: 1026
4. **`1ba9e79`** - Solve 2025 Day 1 Part 2 in C# - Answer: 5923
5. **`1cb371a`** - Improve task extraction formatting
6. **`abb98de`** - Add line breaks after task headers

### Technical Details

**C# Test Structure:**
```csharp
#if DEBUG
static class Tests
{
    public static void RunTests()
    {
        TestPart1();
        TestPart2();
        Console.WriteLine("All tests passed!");
    }

    static void TestPart1()
    {
        const string input = @"example
multi-line
input";
        const string expected = "42";
        
        var result = Solution.Part1(input);
        if (result != expected)
            throw new Exception($"Part 1 test failed: expected '{expected}', got '{result}'");
        
        Console.WriteLine("âœ“ Part 1 test passed");
    }
}
#endif
```

**Features:**
- Verbatim strings (`@"..."`) for multi-line examples
- Clear error messages with expected vs actual
- Loud failures (exceptions, not silent fails)
- Visual confirmation (âœ“ checkmarks)

### Key Benefits

1. **TDD Workflow Parity** - C# now matches Zig's TDD capabilities
2. **Clean Task Files** - No more HTML clutter in problem statements
3. **Consistent Formatting** - All languages use same task format
4. **Automated Testing** - Tests auto-generated from examples
5. **Global Improvements** - Task parsing benefits all 6 languages

### Lessons Learned

1. **Top-level statements limitation** - Local functions have scoping issues with classes
2. **Static classes solve it** - Proper separation while keeping simplicity
3. **Centralize logic** - One `html_to_text()` function better than duplicated sed commands
4. **AWK is powerful** - Better than complex sed chains for pattern-based text processing
5. **Test in isolation** - Compilation errors caught by testing new template structure

---

## End of Conversation Log

Last updated: 2025-12-01
Repository: https://github.com/hamburger1984/advent-of-code
Prepared by: Claude (Anthropic AI Assistant)
For: Andreas (hamburger1984@gmail.com)
